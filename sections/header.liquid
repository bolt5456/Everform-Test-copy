{% comment %}
  Site Header
  Features: Logo, Navigation, Search, Account, Cart
{% endcomment %}

<header class="header" data-header>
  <div class="header__container container">
    <div class="header__inner">
      {%- comment -%}Mobile menu toggle{%- endcomment -%}
      <button class="header__menu-toggle mobile-menu-toggle show-mobile"
              aria-label="Open menu"
              aria-expanded="false">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="3" y1="12" x2="21" y2="12"></line>
          <line x1="3" y1="6" x2="21" y2="6"></line>
          <line x1="3" y1="18" x2="21" y2="18"></line>
        </svg>
      </button>

      {%- comment -%}Logo{%- endcomment -%}
      <div class="header__logo">
        <a href="{{ routes.root_url }}" class="logo">
          {% if section.settings.logo != blank %}
            <img src="{{ section.settings.logo | image_url: width: 200 }}"
                 alt="{{ shop.name }}"
                 width="{{ section.settings.logo_width }}"
                 height="auto"
                 loading="eager">
          {% else %}
            <span class="logo__text">{{ shop.name }}</span>
          {% endif %}
        </a>
      </div>

      {%- comment -%}Desktop navigation{%- endcomment -%}
      <nav class="header__nav hide-mobile" aria-label="Main navigation">
        <ul class="nav-menu">
          {% for link in section.settings.main_menu.links %}
            <li class="nav-menu__item{% if link.links != blank %} nav-menu__item--has-dropdown{% endif %}">
              <a href="{{ link.url }}"
                 class="nav-menu__link{% if link.active %} nav-menu__link--active{% endif %}"
                 {% if link.links != blank %}aria-expanded="false"{% endif %}>
                {{ link.title }}
                {% if link.links != blank %}
                  <svg class="nav-menu__icon" width="12" height="8" viewBox="0 0 12 8" fill="currentColor">
                    <path d="M1 1l5 5 5-5"/>
                  </svg>
                {% endif %}
              </a>

              {% if link.links != blank %}
                <ul class="nav-dropdown">
                  {% for child_link in link.links %}
                    <li class="nav-dropdown__item{% if child_link.links != blank %} nav-dropdown__item--has-children{% endif %}">
                      <a href="{{ child_link.url }}"
                         class="nav-dropdown__link{% if child_link.active %} nav-dropdown__link--active{% endif %}">
                        {{ child_link.title }}
                      </a>

                      {% if child_link.links != blank %}
                        <ul class="nav-dropdown nav-dropdown--nested">
                          {% for grandchild_link in child_link.links %}
                            <li class="nav-dropdown__item">
                              <a href="{{ grandchild_link.url }}"
                                 class="nav-dropdown__link{% if grandchild_link.active %} nav-dropdown__link--active{% endif %}">
                                {{ grandchild_link.title }}
                              </a>
                            </li>
                          {% endfor %}
                        </ul>
                      {% endif %}
                    </li>
                  {% endfor %}
                </ul>
              {% endif %}
            </li>
          {% endfor %}

          {%- comment -%}Request Quote CTA Button{%- endcomment -%}
          {% if section.settings.show_quote_button %}
            <li class="nav-menu__item nav-menu__item--cta">
              <a href="{{ section.settings.quote_button_url }}" class="btn btn--primary btn--sm">
                {{ section.settings.quote_button_text }}
              </a>
            </li>
          {% endif %}
        </ul>
      </nav>

      {%- comment -%}Header actions{%- endcomment -%}
      <div class="header__actions">
        {%- comment -%}Search{%- endcomment -%}
        {% if section.settings.enable_search %}
          <a href="{{ routes.search_url }}" class="header__action" aria-label="Search">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="8" cy="8" r="6"/>
              <path d="M13 13l5 5"/>
            </svg>
          </a>
        {% endif %}

        {%- comment -%}Account{%- endcomment -%}
        {% if section.settings.enable_account %}
          <a href="{{ routes.account_url }}" class="header__action" aria-label="Account">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="10" cy="6" r="4"/>
              <path d="M2 18c0-4.4 3.6-8 8-8s8 3.6 8 8"/>
            </svg>
          </a>
        {% endif %}

        {%- comment -%}Cart{%- endcomment -%}
        <a href="{{ routes.cart_url }}" class="header__action header__cart" aria-label="Cart">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M1 1h3l2 13h11l3-9H6"/>
            <circle cx="7" cy="18" r="1" fill="currentColor"/>
            <circle cx="15" cy="18" r="1" fill="currentColor"/>
          </svg>
          <span class="header__cart-count" data-cart-count>{{ cart.item_count }}</span>
        </a>
      </div>
    </div>
  </div>

  {%- comment -%}Mobile menu{%- endcomment -%}
  <div class="mobile-menu" aria-hidden="true">
    <div class="mobile-menu__header">
      <span class="mobile-menu__title">Menu</span>
      <button class="mobile-menu__close" aria-label="Close menu">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>

    <nav class="mobile-menu__nav">
      <ul class="mobile-nav">
        {% for link in section.settings.main_menu.links %}
          <li class="mobile-nav__item{% if link.links != blank %} mobile-nav__item--has-children{% endif %}">
            <a href="{{ link.url }}" class="mobile-nav__link{% if link.active %} mobile-nav__link--active{% endif %}">
              {{ link.title }}
            </a>

            {% if link.links != blank %}
              <button class="mobile-nav__toggle" aria-label="Toggle submenu">
                <svg width="12" height="12" viewBox="0 0 12 12" fill="currentColor">
                  <path d="M6 0v12M0 6h12"/>
                </svg>
              </button>

              <ul class="mobile-nav__submenu">
                {% for child_link in link.links %}
                  <li class="mobile-nav__item">
                    <a href="{{ child_link.url }}" class="mobile-nav__link">
                      {{ child_link.title }}
                    </a>

                    {% if child_link.links != blank %}
                      <ul class="mobile-nav__submenu mobile-nav__submenu--nested">
                        {% for grandchild_link in child_link.links %}
                          <li class="mobile-nav__item">
                            <a href="{{ grandchild_link.url }}" class="mobile-nav__link">
                              {{ grandchild_link.title }}
                            </a>
                          </li>
                        {% endfor %}
                      </ul>
                    {% endif %}
                  </li>
                {% endfor %}
              </ul>
            {% endif %}
          </li>
        {% endfor %}
      </ul>

      {% if section.settings.show_quote_button %}
        <div class="mobile-menu__cta">
          <a href="{{ section.settings.quote_button_url }}" class="btn btn--primary btn--full">
            {{ section.settings.quote_button_text }}
          </a>
        </div>
      {% endif %}
    </nav>
  </div>
</header>

<style>
  /* Header styles */
  .header {
    position: sticky;
    top: 0;
    z-index: var(--z-index-sticky);
    background-color: var(--color-white);
    border-bottom: 1px solid var(--color-border);
  }

  .header__inner {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--spacing-lg);
    padding: var(--spacing-md) 0;
  }

  .header__logo .logo {
    display: block;
  }

  .header__logo .logo__text {
    font-size: 1.5rem;
    font-weight: var(--font-weight-bold);
    color: var(--color-black);
  }

  /* Desktop navigation */
  .nav-menu {
    display: flex;
    align-items: center;
    gap: var(--spacing-lg);
    list-style: none;
    margin: 0;
    padding: 0;
  }

  .nav-menu__link {
    display: flex;
    align-items: center;
    gap: var(--spacing-xs);
    padding: var(--spacing-sm) 0;
    font-weight: var(--font-weight-medium);
    color: var(--color-charcoal);
    text-decoration: none;
    transition: color var(--transition-base);
  }

  .nav-menu__link:hover,
  .nav-menu__link--active {
    color: var(--color-primary);
  }

  .nav-menu__item--has-dropdown {
    position: relative;
  }

  .nav-dropdown {
    position: absolute;
    top: 100%;
    left: 0;
    min-width: 220px;
    background-color: var(--color-white);
    border: 1px solid var(--color-border);
    box-shadow: var(--shadow-md);
    opacity: 0;
    visibility: hidden;
    transform: translateY(-8px);
    transition: all var(--transition-base);
    list-style: none;
    margin: 0;
    padding: var(--spacing-sm) 0;
    z-index: var(--z-index-dropdown);
  }

  .nav-menu__item--has-dropdown:hover .nav-dropdown {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
  }

  .nav-dropdown__link {
    display: block;
    padding: var(--spacing-sm) var(--spacing-lg);
    color: var(--color-charcoal);
    text-decoration: none;
    transition: all var(--transition-base);
  }

  .nav-dropdown__link:hover,
  .nav-dropdown__link--active {
    background-color: var(--color-off-white);
    color: var(--color-primary);
  }

  /* Header actions */
  .header__actions {
    display: flex;
    align-items: center;
    gap: var(--spacing-md);
  }

  .header__action {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    color: var(--color-charcoal);
    transition: color var(--transition-base);
  }

  .header__action:hover {
    color: var(--color-primary);
  }

  .header__cart {
    position: relative;
  }

  .header__cart-count {
    position: absolute;
    top: 0;
    right: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    min-width: 18px;
    height: 18px;
    padding: 0 4px;
    background-color: var(--color-primary);
    color: var(--color-white);
    font-size: 11px;
    font-weight: var(--font-weight-bold);
    border-radius: 50%;
  }

  /* Mobile menu toggle */
  .mobile-menu-toggle {
    padding: var(--spacing-xs);
    color: var(--color-charcoal);
  }

  /* Mobile menu */
  .mobile-menu {
    position: fixed;
    top: 0;
    right: 0;
    bottom: 0;
    width: 100%;
    max-width: 400px;
    background-color: var(--color-white);
    box-shadow: var(--shadow-lg);
    transform: translateX(100%);
    transition: transform var(--transition-base);
    z-index: var(--z-index-fixed);
    overflow-y: auto;
  }

  .mobile-menu.is-open {
    transform: translateX(0);
  }

  .mobile-menu__header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: var(--spacing-lg);
    border-bottom: 1px solid var(--color-border);
  }

  .mobile-menu__title {
    font-size: 1.25rem;
    font-weight: var(--font-weight-bold);
  }

  .mobile-menu__close {
    padding: var(--spacing-xs);
  }

  .mobile-nav {
    list-style: none;
    margin: 0;
    padding: var(--spacing-md) 0;
  }

  .mobile-nav__item {
    border-bottom: 1px solid var(--color-border);
  }

  .mobile-nav__link {
    display: block;
    padding: var(--spacing-md) var(--spacing-lg);
    color: var(--color-charcoal);
    text-decoration: none;
    font-weight: var(--font-weight-medium);
  }

  .mobile-nav__link--active {
    color: var(--color-primary);
  }

  .mobile-menu__cta {
    padding: var(--spacing-lg);
  }

  @media (min-width: 1024px) {
    .header__inner {
      padding: var(--spacing-lg) 0;
    }
  }
</style>

<script>
  // Mobile menu functionality
  const menuToggle = document.querySelector('.mobile-menu-toggle');
  const mobileMenu = document.querySelector('.mobile-menu');
  const menuClose = document.querySelector('.mobile-menu__close');

  if (menuToggle && mobileMenu) {
    menuToggle.addEventListener('click', () => {
      mobileMenu.classList.add('is-open');
      document.body.style.overflow = 'hidden';
    });

    menuClose.addEventListener('click', () => {
      mobileMenu.classList.remove('is-open');
      document.body.style.overflow = '';
    });
  }

  // Mobile submenu toggles
  const submenuToggles = document.querySelectorAll('.mobile-nav__toggle');

  submenuToggles.forEach(toggle => {
    toggle.addEventListener('click', (e) => {
      e.preventDefault();
      const submenu = toggle.nextElementSibling;
      const isOpen = submenu.style.display === 'block';

      submenu.style.display = isOpen ? 'none' : 'block';
      toggle.setAttribute('aria-expanded', !isOpen);
    });
  });
</script>

{% schema %}
{
  "name": "Header",
  "settings": [
    {
      "type": "image_picker",
      "id": "logo",
      "label": "Logo Image"
    },
    {
      "type": "range",
      "id": "logo_width",
      "label": "Logo Width (px)",
      "min": 100,
      "max": 300,
      "step": 10,
      "default": 180
    },
    {
      "type": "link_list",
      "id": "main_menu",
      "label": "Main Menu",
      "default": "main-menu"
    },
    {
      "type": "checkbox",
      "id": "enable_search",
      "label": "Enable Search",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "enable_account",
      "label": "Enable Account Link",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_quote_button",
      "label": "Show Request Quote Button",
      "default": true
    },
    {
      "type": "text",
      "id": "quote_button_text",
      "label": "Quote Button Text",
      "default": "Request Quote"
    },
    {
      "type": "url",
      "id": "quote_button_url",
      "label": "Quote Button URL",
      "default": "/pages/quotation-form"
    }
  ]
}
{% endschema %}
