{% comment %}
  Related Products
{% endcomment %}

<section class="related-products section">
  <div class="container">
    {% if section.settings.heading != blank %}
      <h2>{{ section.settings.heading }}</h2>
    {% endif %}

    {% assign current_product = product %}
    {% assign related_collection = collection | default: product.collections.first %}
    {% if related_collection and related_collection.products_count > 1 %}
      <div class="product-grid">
        {% assign shown = 0 %}
        {% for related_product in related_collection.products %}
          {% if related_product.id == current_product.id %}
            {% continue %}
          {% endif %}
          {% render 'product-card', product: related_product %}
          {% assign shown = shown | plus: 1 %}
          {% if shown >= section.settings.products_to_show %}
            {% break %}
          {% endif %}
        {% endfor %}
      </div>
    {% else %}
      <p class="text-muted">No related products found.</p>
    {% endif %}
  </div>
</section>

{% schema %}
{
  "name": "Related Products",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Related products"
    },
    {
      "type": "range",
      "id": "products_to_show",
      "label": "Products to show",
      "min": 2,
      "max": 6,
      "step": 1,
      "default": 4
    }
  ],
  "presets": [
    {
      "name": "Related Products"
    }
  ]
}
{% endschema %}
